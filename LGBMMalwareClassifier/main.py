import DataLoading
import ModelTraining
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score
from sklearn.metrics import confusion_matrix
import lightgbm as lgb
import pandas as pd
import joblib

# Press the green button in the gutter to run the script.
if __name__ == '__main__':
    #df = DataLoading.DataSetLoadFolder("C:/Users/40237845/Downloads/ember_2017_2/Train")
    test = DataLoading.DataSetLoadSingleFile("C:/Users/40237845/Downloads/ember_2017_2/Test/test_features.jsonl")

    #print(df)
    #df["Histogram"] = pd.Categorical(df["Histogram"]).codes

    #X = df.iloc[:, 0:256]
    X_test = test.iloc[:, 0:256]
    #print(X)
    #y = df["Label"]
    y_test = test["Label"]
    #print(y)

    #X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=0)
    #print(X_train)
    #model = ModelTraining.trainmodel(X_train, y_train)
    #model = ModelTraining.trainmodel(X, y)
    model = joblib.load("lgb.pkl")

    y_pred = model.predict(X_test)
    print(y_pred)
    print('LightGBM Model accuracy score: {0:0.4f}'.format(accuracy_score(y_test, y_pred)))

    confusion = confusion_matrix(y_test, y_pred)
    print('Confusion matrix\n\n', confusion)
    print('\nTrue Positives(TP) = ', confusion[0, 0])
    print('\nTrue Negatives(TN) = ', confusion[1, 1])
    print('\nFalse Positives(FP) = ', confusion[0, 1])
    print('\nFalse Negatives(FN) = ', confusion[1, 0])




